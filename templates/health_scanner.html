{% extends "base.html" %}

{% block title %}Health Scanner - Medicine AI{% endblock %}

{% block content %}
<div class="container">
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="display-5 text-teal fw-bold">Health Scanner</h1>
            <p class="lead">Scan your facial features to analyze vital signs and health metrics</p>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-6 mb-4">
            <div class="scan-container">
                <div class="position-relative">
                    <video id="videoElement" autoplay muted playsinline class="w-100"></video>
                    <canvas id="overlay" class="position-absolute top-0 start-0 w-100 h-100" style="display: none;"></canvas>
                    <div id="loading" class="position-absolute top-0 start-0 w-100 h-100 bg-light d-flex justify-content-center align-items-center" style="display: none; opacity: 0.8;">
                        <div class="text-center">
                            <div class="spinner-border text-teal mb-3" role="status"></div>
                            <p class="mb-0 fw-medium">Analyzing your health metrics...</p>
                        </div>
                    </div>
                </div>
                <div class="scan-controls">
                    <button id="startScan" class="btn btn-teal">
                        <i data-feather="activity" class="me-2"></i> Start Health Scan
                    </button>
                    <button id="captureFace" class="btn btn-outline-teal" disabled>
                        <i data-feather="camera" class="me-2"></i> Capture
                    </button>
                    <button id="recordVoice" class="btn btn-outline-teal" disabled>
                        <i data-feather="mic" class="me-2"></i> Record Voice
                    </button>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header bg-teal text-white">
                    <h3 class="mb-0 fs-5">How It Works</h3>
                </div>
                <div class="card-body">
                    <ol class="mb-0">
                        <li class="mb-2">Click "Start Health Scan" to initialize your camera</li>
                        <li class="mb-2">Position your face clearly in the frame</li>
                        <li class="mb-2">Press "Capture" to scan your facial features</li>
                        <li class="mb-2">Optionally record voice for enhanced analysis</li>
                        <li>Review your comprehensive health assessment</li>
                    </ol>
                </div>
            </div>

            <div class="card">
                <div class="card-header bg-teal text-white">
                    <h3 class="mb-0 fs-5">Privacy Information</h3>
                </div>
                <div class="card-body">
                    <p class="mb-0">All health scanning is performed securely. Your facial data is processed locally in your browser and is not permanently stored. Results are saved to your account for historical tracking purposes.</p>
                </div>
            </div>
        </div>

        <div class="col-lg-6">
            <div id="results" style="display: none;">
                <!-- Wellness Score Card -->
                <div class="wellness-score-card mb-4">
                    <h3 class="mb-3">Your Wellness Score</h3>
                    <div class="score-value" id="wellnessScore">0</div>
                    <div class="score-label" id="wellnessLabel">Calculating...</div>
                    
                    <div class="score-breakdown">
                        <div class="score-item">
                            <div class="score-item-value" id="heartAge">--</div>
                            <div class="score-item-label">Heart Age</div>
                        </div>
                        <div class="score-item">
                            <div class="score-item-value" id="stressLevel">--</div>
                            <div class="score-item-label">Stress</div>
                        </div>
                        <div class="score-item">
                            <div class="score-item-value" id="recoveryLevel">--</div>
                            <div class="score-item-label">Recovery</div>
                        </div>
                    </div>
                </div>

                <!-- Vital Signs Card -->
                <div class="result-card mb-4">
                    <div class="result-header">
                        <h3 class="mb-0 fs-5">Vital Signs</h3>
                    </div>
                    <div class="result-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="health-metric">
                                    <div class="metric-header">
                                        <div class="metric-name">Heart Rate</div>
                                        <div class="metric-value" id="heartRate">-- bpm</div>
                                    </div>
                                    <div class="metric-bar">
                                        <div class="metric-progress" id="heartRateBar" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="health-metric">
                                    <div class="metric-header">
                                        <div class="metric-name">Blood Pressure</div>
                                        <div class="metric-value" id="bloodPressure">--/-- mmHg</div>
                                    </div>
                                    <div class="metric-bar">
                                        <div class="metric-progress" id="bloodPressureBar" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="health-metric">
                                    <div class="metric-header">
                                        <div class="metric-name">Breathing Rate</div>
                                        <div class="metric-value" id="breathingRate">-- bpm</div>
                                    </div>
                                    <div class="metric-bar">
                                        <div class="metric-progress" id="breathingRateBar" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="health-metric">
                                    <div class="metric-header">
                                        <div class="metric-name">Oxygen Saturation</div>
                                        <div class="metric-value" id="oxygenSaturation">--%</div>
                                    </div>
                                    <div class="metric-bar">
                                        <div class="metric-progress" id="oxygenSaturationBar" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="health-metric">
                                    <div class="metric-header">
                                        <div class="metric-name">Hemoglobin</div>
                                        <div class="metric-value" id="hemoglobin">-- g/dL</div>
                                    </div>
                                    <div class="metric-bar">
                                        <div class="metric-progress" id="hemoglobinBar" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="health-metric">
                                    <div class="metric-header">
                                        <div class="metric-name">HbA1c</div>
                                        <div class="metric-value" id="hba1c">--%</div>
                                    </div>
                                    <div class="metric-bar">
                                        <div class="metric-progress" id="hba1cBar" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Health Risks Card -->
                <div class="result-card mb-4">
                    <div class="result-header">
                        <h3 class="mb-0 fs-5">Health Risk Assessment</h3>
                    </div>
                    <div class="result-body">
                        <div class="health-metric">
                            <div class="metric-header">
                                <div class="metric-name">Cardiovascular Risk (ASCVD)</div>
                                <div class="metric-value" id="ascvdRisk">--%</div>
                            </div>
                            <div class="metric-bar">
                                <div class="metric-progress risk-low" id="ascvdRiskBar" style="width: 0%"></div>
                            </div>
                        </div>
                        
                        <div class="health-metric">
                            <div class="metric-header">
                                <div class="metric-name">Hypertension Risk</div>
                                <div class="metric-value" id="hypertensionRisk">--%</div>
                            </div>
                            <div class="metric-bar">
                                <div class="metric-progress risk-low" id="hypertensionRiskBar" style="width: 0%"></div>
                            </div>
                        </div>
                        
                        <div class="health-metric">
                            <div class="metric-header">
                                <div class="metric-name">High Glucose Risk</div>
                                <div class="metric-value" id="glucoseRisk">--%</div>
                            </div>
                            <div class="metric-bar">
                                <div class="metric-progress risk-low" id="glucoseRiskBar" style="width: 0%"></div>
                            </div>
                        </div>
                        
                        <div class="health-metric">
                            <div class="metric-header">
                                <div class="metric-name">High Cholesterol Risk</div>
                                <div class="metric-value" id="cholesterolRisk">--%</div>
                            </div>
                            <div class="metric-bar">
                                <div class="metric-progress risk-low" id="cholesterolRiskBar" style="width: 0%"></div>
                            </div>
                        </div>
                        
                        <div class="health-metric">
                            <div class="metric-header">
                                <div class="metric-name">Tuberculosis Risk</div>
                                <div class="metric-value" id="tbRisk">--%</div>
                            </div>
                            <div class="metric-bar">
                                <div class="metric-progress risk-low" id="tbRiskBar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recommendations Card -->
                <div class="result-card mb-4">
                    <div class="result-header">
                        <h3 class="mb-0 fs-5">Recommendations</h3>
                    </div>
                    <div class="result-body">
                        <div id="recommendations">
                            <p class="text-center text-muted">Loading recommendations...</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="noResults" class="text-center py-5">
                <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#20c997" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather feather-activity mb-3"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></svg>
                <h3 class="text-teal mb-3">Ready for Your Health Scan</h3>
                <p class="text-muted">Start your health scan to see your vital signs and wellness assessment.</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/health_scanner.js') }}"></script>
{% endblock %}
